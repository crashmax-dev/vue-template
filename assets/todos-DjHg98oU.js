import{S as St,p as rt,q as m,s as H,v as U,x as wt,y as at,z as ot,A as Pt,B as M,C as It,D as xt,E as ut,G as Dt,H as Qt,I as jt,J as Ut,f as V,K as Ft,L as At,M as Mt,N as $,O as $t,P as Lt,Q as Vt,R as Bt,T as lt,U as ct,W as q,d as z,c as C,o as R,X as Nt,k as qt,_ as G,F as B,a as v,i as pt,u as _,t as N,e as vt,r as yt,Y as zt,j as mt,b,w as T,h as O,Z as Gt,g as Wt}from"./index-Ck8R77JD.js";var Kt=class extends St{constructor(t,e){super(),this.options=e,this.#s=t,this.#n=null,this.#i=rt(),this.bindMethods(),this.setOptions(e)}#s;#t=void 0;#p=void 0;#e=void 0;#a;#c;#i;#n;#v;#d;#h;#o;#u;#r;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),dt(this.#t,this.options)?this.#l():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return X(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return X(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#R(),this.#_(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,s=this.#t;if(this.options=this.#s.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof m(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#C(),this.#t.setOptions(this.options),e._defaulted&&!H(this.options,e)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const i=this.hasListeners();i&&ht(this.#t,s,this.options,e)&&this.#l(),this.updateResult(),i&&(this.#t!==s||m(this.options.enabled,this.#t)!==m(e.enabled,this.#t)||U(this.options.staleTime,this.#t)!==U(e.staleTime,this.#t))&&this.#y();const n=this.#m();i&&(this.#t!==s||m(this.options.enabled,this.#t)!==m(e.enabled,this.#t)||n!==this.#r)&&this.#g(n)}getOptimisticResult(t){const e=this.#s.getQueryCache().build(this.#s,t),s=this.createResult(e,t);return Xt(this,s)&&(this.#e=s,this.#c=this.options,this.#a=this.#t.state),s}getCurrentResult(){return this.#e}trackResult(t,e){return new Proxy(t,{get:(s,i)=>(this.trackProp(i),e?.(i),i==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#i.status==="pending"&&this.#i.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(s,i))})}trackProp(t){this.#f.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#s.defaultQueryOptions(t),s=this.#s.getQueryCache().build(this.#s,e);return s.fetch().then(()=>this.createResult(s,e))}fetch(t){return this.#l({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#e))}#l(t){this.#C();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(wt)),e}#y(){this.#R();const t=U(this.options.staleTime,this.#t);if(at||this.#e.isStale||!ot(t))return;const s=Pt(this.#e.dataUpdatedAt,t)+1;this.#o=M.setTimeout(()=>{this.#e.isStale||this.updateResult()},s)}#m(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#g(t){this.#_(),this.#r=t,!(at||m(this.options.enabled,this.#t)===!1||!ot(this.#r)||this.#r===0)&&(this.#u=M.setInterval(()=>{(this.options.refetchIntervalInBackground||It.isFocused())&&this.#l()},this.#r))}#b(){this.#y(),this.#g(this.#m())}#R(){this.#o&&(M.clearTimeout(this.#o),this.#o=void 0)}#_(){this.#u&&(M.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const s=this.#t,i=this.options,n=this.#e,a=this.#a,r=this.#c,l=t!==s?t.state:this.#p,{state:d}=t;let o={...d},k=!1,h;if(e._optimisticResults){const p=this.hasListeners(),F=!p&&dt(t,e),x=p&&ht(t,s,e,i);(F||x)&&(o={...o,...xt(d.data,t.options)}),e._optimisticResults==="isRestoring"&&(o.fetchStatus="idle")}let{error:c,errorUpdatedAt:y,status:f}=o;h=o.data;let Q=!1;if(e.placeholderData!==void 0&&h===void 0&&f==="pending"){let p;n?.isPlaceholderData&&e.placeholderData===r?.placeholderData?(p=n.data,Q=!0):p=typeof e.placeholderData=="function"?e.placeholderData(this.#h?.state.data,this.#h):e.placeholderData,p!==void 0&&(f="success",h=ut(n?.data,p,e),k=!0)}if(e.select&&h!==void 0&&!Q)if(n&&h===a?.data&&e.select===this.#v)h=this.#d;else try{this.#v=e.select,h=e.select(h),h=ut(n?.data,h,e),this.#d=h,this.#n=null}catch(p){this.#n=p}this.#n&&(c=this.#n,h=this.#d,y=Date.now(),f="error");const P=o.fetchStatus==="fetching",I=f==="pending",W=f==="error",it=I&&P,nt=h!==void 0,g={status:f,fetchStatus:o.fetchStatus,isPending:I,isSuccess:f==="success",isError:W,isInitialLoading:it,isLoading:it,data:h,dataUpdatedAt:o.dataUpdatedAt,error:c,errorUpdatedAt:y,failureCount:o.fetchFailureCount,failureReason:o.fetchFailureReason,errorUpdateCount:o.errorUpdateCount,isFetched:o.dataUpdateCount>0||o.errorUpdateCount>0,isFetchedAfterMount:o.dataUpdateCount>l.dataUpdateCount||o.errorUpdateCount>l.errorUpdateCount,isFetching:P,isRefetching:P&&!I,isLoadingError:W&&!nt,isPaused:o.fetchStatus==="paused",isPlaceholderData:k,isRefetchError:W&&nt,isStale:J(t,e),refetch:this.refetch,promise:this.#i,isEnabled:m(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const p=A=>{g.status==="error"?A.reject(g.error):g.data!==void 0&&A.resolve(g.data)},F=()=>{const A=this.#i=g.promise=rt();p(A)},x=this.#i;switch(x.status){case"pending":t.queryHash===s.queryHash&&p(x);break;case"fulfilled":(g.status==="error"||g.data!==x.value)&&F();break;case"rejected":(g.status!=="error"||g.error!==x.reason)&&F();break}}return g}updateResult(){const t=this.#e,e=this.createResult(this.#t,this.options);if(this.#a=this.#t.state,this.#c=this.options,this.#a.data!==void 0&&(this.#h=this.#t),H(e,t))return;this.#e=e;const s=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,n=typeof i=="function"?i():i;if(n==="all"||!n&&!this.#f.size)return!0;const a=new Set(n??this.#f);return this.options.throwOnError&&a.add("error"),Object.keys(this.#e).some(r=>{const u=r;return this.#e[u]!==t[u]&&a.has(u)})};this.#E({listeners:s()})}#C(){const t=this.#s.getQueryCache().build(this.#s,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#p=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#E(t){Dt.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#e)}),this.#s.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Ht(t,e){return m(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function dt(t,e){return Ht(t,e)||t.state.data!==void 0&&X(t,e,e.refetchOnMount)}function X(t,e,s){if(m(e.enabled,t)!==!1&&U(e.staleTime,t)!=="static"){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&J(t,e)}return!1}function ht(t,e,s,i){return(t!==e||m(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&J(t,s)}function J(t,e){return m(e.enabled,t)!==!1&&t.isStaleByTime(U(e.staleTime,t))}function Xt(t,e){return!H(t.getCurrentResult(),e)}function gt(t=""){if(!Qt())throw new Error("vue-query hooks can only be used inside setup() function or functions that support injection context.");const e=Ut(t),s=jt(e);if(!s)throw new Error("No 'queryClient' found in Vue context, use 'VueQueryPlugin' to properly initialize the library.");return s}function Zt(t,e,s){const i=gt(),n=V(()=>{let c=e;typeof c=="function"&&(c=c());const y=Ft(c);typeof y.enabled=="function"&&(y.enabled=y.enabled());const f=i.defaultQueryOptions(y);return f._optimisticResults=i.isRestoring?.value?"isRestoring":"optimistic",f}),a=new t(i,n.value),r=n.value.shallow?At(a.getCurrentResult()):Mt(a.getCurrentResult());let u=()=>{};i.isRestoring&&$(i.isRestoring,c=>{c||(u(),u=a.subscribe(y=>{ct(r,y)}))},{immediate:!0});const l=()=>{a.setOptions(n.value),ct(r,a.getCurrentResult())};$(n,l),$t(()=>{u()});const d=(...c)=>(l(),r.refetch(...c)),o=()=>new Promise((c,y)=>{let f=()=>{};const Q=()=>{if(n.value.enabled!==!1){a.setOptions(n.value);const P=a.getOptimisticResult(n.value);P.isStale?(f(),a.fetchOptimistic(n.value).then(c,I=>{lt(n.value.throwOnError,[I,a.getCurrentQuery()])?y(I):c(a.getCurrentResult())})):(f(),c(P))}};Q(),f=$(n,Q)});$(()=>r.error,c=>{if(r.isError&&!r.isFetching&&lt(n.value.throwOnError,[c,a.getCurrentQuery()]))throw c});const k=n.value.shallow?Lt(r):Vt(r),h=Bt(k);for(const c in r)typeof r[c]=="function"&&(h[c]=r[c]);return h.suspense=o,h.refetch=d,h}function Jt(t,e){return Zt(Kt,t)}let K;function bt(t){return{lang:t?.lang??K?.lang,message:t?.message,abortEarly:t?.abortEarly??K?.abortEarly,abortPipeEarly:t?.abortPipeEarly??K?.abortPipeEarly}}let Yt;function te(t){return Yt?.get(t)}let ee;function se(t){return ee?.get(t)}let ie;function ne(t,e){return ie?.get(t)?.get(e)}function Rt(t){const e=typeof t;return e==="string"?`"${t}"`:e==="number"||e==="bigint"||e==="boolean"?`${t}`:e==="object"||e==="function"?(t&&Object.getPrototypeOf(t)?.constructor?.name)??"null":e}function E(t,e,s,i,n){const a=n&&"input"in n?n.input:s.value,r=n?.expected??t.expects??null,u=n?.received??Rt(a),l={kind:t.kind,type:t.type,input:a,expected:r,received:u,message:`Invalid ${e}: ${r?`Expected ${r} but r`:"R"}eceived ${u}`,requirement:t.requirement,path:n?.path,issues:n?.issues,lang:i.lang,abortEarly:i.abortEarly,abortPipeEarly:i.abortPipeEarly},d=t.kind==="schema",o=n?.message??t.message??ne(t.reference,l.lang)??(d?se(l.lang):null)??i.message??te(l.lang);o!==void 0&&(l.message=typeof o=="function"?o(l):o),d&&(s.typed=!1),s.issues?s.issues.push(l):s.issues=[l]}function D(t){return{version:1,vendor:"valibot",validate(e){return t["~run"]({value:e},bt())}}}function re(t,e){const s=[...new Set(t)];return s.length>1?`(${s.join(` ${e} `)})`:s[0]??"never"}var ae=class extends Error{constructor(t){super(t[0].message),this.name="ValiError",this.issues=t}};const oe=/^\d{4}-(?:0[1-9]|1[0-2])-(?:[12]\d|0[1-9]|3[01])[T ](?:0\d|1\d|2[0-3])(?::[0-5]\d){2}(?:\.\d{1,9})?(?:Z|[+-](?:0\d|1\d|2[0-3])(?::?[0-5]\d)?)$/u,ue=/^[\da-f]{8}(?:-[\da-f]{4}){3}-[\da-f]{12}$/iu;function Z(t){return{kind:"validation",type:"iso_timestamp",reference:Z,async:!1,expects:null,requirement:oe,message:t,"~run"(e,s){return e.typed&&!this.requirement.test(e.value)&&E(this,"timestamp",e,s),e}}}function _t(t,e){return{kind:"validation",type:"max_length",reference:_t,async:!1,expects:`<=${t}`,requirement:t,message:e,"~run"(s,i){return s.typed&&s.value.length>this.requirement&&E(this,"length",s,i,{received:`${s.value.length}`}),s}}}function L(){return{kind:"transformation",type:"readonly",reference:L,async:!1,"~run"(t){return t}}}function Ct(t){return{kind:"validation",type:"uuid",reference:Ct,async:!1,expects:null,requirement:ue,message:t,"~run"(e,s){return e.typed&&!this.requirement.test(e.value)&&E(this,"UUID",e,s),e}}}function le(t,e,s){return typeof t.fallback=="function"?t.fallback(e,s):t.fallback}function ce(t,e,s){return typeof t.default=="function"?t.default(e,s):t.default}function Et(t,e){return{kind:"schema",type:"array",reference:Et,expects:"Array",async:!1,item:t,message:e,get"~standard"(){return D(this)},"~run"(s,i){const n=s.value;if(Array.isArray(n)){s.typed=!0,s.value=[];for(let a=0;a<n.length;a++){const r=n[a],u=this.item["~run"]({value:r},i);if(u.issues){const l={type:"array",origin:"value",input:n,key:a,value:r};for(const d of u.issues)d.path?d.path.unshift(l):d.path=[l],s.issues?.push(d);if(s.issues||(s.issues=u.issues),i.abortEarly){s.typed=!1;break}}u.typed||(s.typed=!1),s.value.push(u.value)}}else E(this,"type",s,i);return s}}}function kt(t){return{kind:"schema",type:"number",reference:kt,expects:"number",async:!1,message:t,get"~standard"(){return D(this)},"~run"(e,s){return typeof e.value=="number"&&!isNaN(e.value)?e.typed=!0:E(this,"type",e,s),e}}}function Y(t,e){return{kind:"schema",type:"object",reference:Y,expects:"Object",async:!1,entries:t,message:e,get"~standard"(){return D(this)},"~run"(s,i){const n=s.value;if(n&&typeof n=="object"){s.typed=!0,s.value={};for(const a in this.entries){const r=this.entries[a];if(a in n||(r.type==="exact_optional"||r.type==="optional"||r.type==="nullish")&&r.default!==void 0){const u=a in n?n[a]:ce(r),l=r["~run"]({value:u},i);if(l.issues){const d={type:"object",origin:"value",input:n,key:a,value:u};for(const o of l.issues)o.path?o.path.unshift(d):o.path=[d],s.issues?.push(o);if(s.issues||(s.issues=l.issues),i.abortEarly){s.typed=!1;break}}l.typed||(s.typed=!1),s.value[a]=l.value}else if(r.fallback!==void 0)s.value[a]=le(r);else if(r.type!=="exact_optional"&&r.type!=="optional"&&r.type!=="nullish"&&(E(this,"key",s,i,{input:void 0,expected:`"${a}"`,path:[{type:"object",origin:"key",input:n,key:a,value:n[a]}]}),i.abortEarly))break}}else E(this,"type",s,i);return s}}}function Tt(t,e){return{kind:"schema",type:"picklist",reference:Tt,expects:re(t.map(Rt),"|"),async:!1,options:t,message:e,get"~standard"(){return D(this)},"~run"(s,i){return this.options.includes(s.value)?s.typed=!0:E(this,"type",s,i),s}}}function j(t){return{kind:"schema",type:"string",reference:j,expects:"string",async:!1,message:t,get"~standard"(){return D(this)},"~run"(e,s){return typeof e.value=="string"?e.typed=!0:E(this,"type",e,s),e}}}async function tt(t,e,s){const i=await t["~run"]({value:e},bt(s));if(i.issues)throw new ae(i.issues);return i.value}function w(...t){return{...t[0],pipe:t,get"~standard"(){return D(this)},"~run"(e,s){for(const i of t)if(i.kind!=="metadata"){if(e.issues&&(i.kind==="schema"||i.kind==="transformation")){e.typed=!1;break}(!e.issues||!s.abortEarly&&!s.abortPipeEarly)&&(e=i["~run"](e,s))}return e}}}const de=Tt(["Active","Cancelled","Paused","Completed"]),et=Y({uuid:w(w(j(),Ct()),L()),title:w(j(),_t(200)),status:de,createdAt:w(w(j(),Z()),L()),updatedAt:w(w(j(),Z()),L())}),he=Y({data:Et(et),total:kt()}),fe=et,pe=et,ve=t=>(t.client??q).get({responseValidator:async e=>await tt(he,e),url:"/todos",...t}),ye=t=>(t.client??q).post({responseValidator:async e=>await tt(fe,e),url:"/todos",...t,headers:{"Content-Type":"application/json",...t.headers}}),me=t=>(t.client??q).delete({url:"/todos/{uuid}",...t}),ge=t=>(t.client??q).patch({responseValidator:async e=>await tt(pe,e),url:"/todos/{uuid}",...t,headers:{"Content-Type":"application/json",...t.headers}}),be=z({__name:"todo-button",props:{variant:{}},setup(t){return(e,s)=>(R(),C("button",{class:Nt(["btn",`btn-${t.variant}`])},[qt(e.$slots,"default",{},void 0,!0)],2))}}),S=G(be,[["__scopeId","data-v-f479e80e"]]),ft={ACTIVE:"Active",CANCELLED:"Cancelled",PAUSED:"Paused",COMPLETED:"Completed"},Re=["value"],_e=["value"],Ce=["value"],Ee=z({__name:"todo-form",props:{todo:{default:()=>({title:"",status:ft.ACTIVE})}},setup(t){return(e,s)=>(R(),C(B,null,[v("input",{name:"title",class:"input-field",value:t.todo.title},null,8,Re),v("select",{value:t.todo.status,name:"status",class:"select-field"},[(R(!0),C(B,null,pt(Object.values(_(ft)),i=>(R(),C("option",{key:i,value:i},N(i),9,Ce))),128))],8,_e)],64))}}),Ot=G(Ee,[["__scopeId","data-v-982d9a00"]]),st=vt("todos/use-pagination",()=>{const t=yt(10),e=V(()=>({start:0,limit:t.value})),s=zt({...e.value});function i(a){a.target==="prev"&&s.value.start===0||a.target==="next"&&s.value.start+t.value>=a.total||(s.value={...s.value,start:a.target==="prev"?s.value.start-t.value:s.value.start+t.value})}function n(){s.value={...e.value}}return{pageSize:t,pagination:s,resetPagination:n,updatePagination:i}}),ke={class:"todo-item"},Te={class:"todo-item__title"},Oe={class:"todo-item__status"},Se=z({__name:"todo-item",props:{todo:{}},setup(t){const e=t,s=yt(!1),i=st(),n=gt();async function a(){return await n.invalidateQueries({queryKey:["todos"]}),n.getQueryData(["todos",i.pagination])}function r(){s.value=!s.value}function u(d){me({path:{uuid:d.uuid}}).then(async()=>{const o=await a();o&&o.data.length===0&&o.total!==0&&i.updatePagination({target:"prev",total:o.total})})}function l(d){const o=new FormData(d.target),k=Object.fromEntries(o);k.title&&ge({path:{uuid:e.todo.uuid},body:k}).then(()=>{r(),a()})}return(d,o)=>(R(),C("li",ke,[s.value?(R(),C("form",{key:0,class:"todo-item__form",onSubmit:mt(l,["prevent"])},[b(Ot,{todo:t.todo},null,8,["todo"]),b(S,{variant:"secondary",type:"button",onClick:r},{default:T(()=>[...o[1]||(o[1]=[O(" Cancel ",-1)])]),_:1}),b(S,{variant:"primary",type:"submit"},{default:T(()=>[...o[2]||(o[2]=[O(" Save ",-1)])]),_:1})],32)):(R(),C(B,{key:1},[v("span",Te,N(t.todo.title),1),v("span",Oe,N(t.todo.status),1),b(S,{variant:"icon",onClick:r},{default:T(()=>[...o[3]||(o[3]=[O(" Edit ",-1)])]),_:1}),b(S,{variant:"danger",onClick:o[0]||(o[0]=k=>u(t.todo))},{default:T(()=>[...o[4]||(o[4]=[O(" Delete ",-1)])]),_:1})],64))]))}}),we=G(Se,[["__scopeId","data-v-b9441658"]]),Pe=vt("todos/use-todos",()=>{const{pageSize:t,pagination:e}=Gt(st()),{isFetching:s,data:i,refetch:n}=Jt({queryKey:["todos",e],initialData:()=>({data:[],total:0}),queryFn:async()=>{const{data:u}=await ve({query:e.value});return u}}),a=V(()=>e.value.start===0||s.value),r=V(()=>e.value.start+t.value>=i.value.total||s.value);return{isFetching:s,data:i,isPagePrevDisabled:a,isPageNextDisabled:r,refetchTodos:n}}),Ie={class:"todo-app"},xe={class:"form-row"},De={class:"form-actions"},Qe={class:"todos-section"},je={class:"todos-header"},Ue={class:"todos-title"},Fe={class:"pagination-controls"},Ae={class:"todos-list"},Me=z({__name:"todos",setup(t){const e=Pe(),s=st();function i(a){const r=a.target,u=new FormData(r),l=Object.fromEntries(u);l.title&&ye({body:l}).then(()=>{r.reset(),e.refetchTodos()})}function n(){confirm("Reset todos?")&&(window.__MSW__.todos?.createInitialData(),s.resetPagination())}return(a,r)=>(R(),C("div",Ie,[v("form",{class:"todo-form",onSubmit:mt(i,["prevent"])},[v("div",xe,[b(Ot)]),v("div",De,[b(S,{type:"submit",variant:"primary",class:"form-actions__submit"},{default:T(()=>[...r[2]||(r[2]=[O(" Create ",-1)])]),_:1})])],32),v("div",Qe,[v("div",je,[v("h2",Ue," Todos (total: "+N(_(e).data.total)+") ",1),v("div",Fe,[b(S,{variant:"danger",onClick:n},{default:T(()=>[...r[3]||(r[3]=[O(" Reset todos ",-1)])]),_:1}),b(S,{variant:"icon",disabled:_(e).isPagePrevDisabled,onClick:r[0]||(r[0]=u=>_(s).updatePagination({target:"prev",total:_(e).data.total}))},{default:T(()=>[...r[4]||(r[4]=[O(" Prev ",-1)])]),_:1},8,["disabled"]),b(S,{variant:"icon",disabled:_(e).isPageNextDisabled,onClick:r[1]||(r[1]=u=>_(s).updatePagination({target:"next",total:_(e).data.total}))},{default:T(()=>[...r[5]||(r[5]=[O(" Next ",-1)])]),_:1},8,["disabled"])])]),v("ul",Ae,[(R(!0),C(B,null,pt(_(e).data.data,u=>(R(),Wt(we,{key:u.uuid,todo:u},null,8,["todo"]))),128))])])]))}}),Ve=G(Me,[["__scopeId","data-v-9d4f66d7"]]);export{Ve as default};
